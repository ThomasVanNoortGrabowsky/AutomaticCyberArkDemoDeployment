{
  "variables": {
    "vm_name":        "Win2022_GUI",
    "iso_url":        "https://software-download.microsoft.com/download/sg/20348.169.210806-2348.fe_release_svc_refresh_SERVER_EVAL_x64FRE_en-us.iso",
    "iso_checksum":   "4f1457c4fe14ce48c9b2324924f33ca4f0470475e6da851b39ccbf98f44e7852",
    "memsize":        "2048",
    "numvcpus":       "2",
    "winrm_username": "Administrator",
    "winrm_password": "packer"
  },
  "builders": [
    {
      "type":             "vmware-iso",
      "vm_name":          "{{user `vm_name`}}",
      "iso_url":          "{{user `iso_url`}}",
      "iso_checksum":     "{{user `iso_checksum`}}",
      "communicator":     "winrm",
      "winrm_username":   "{{user `winrm_username`}}",
      "winrm_password":   "{{user `winrm_password`}}",
      "vmx_data": {
        "memsize":  "{{user `memsize`}}",
        "numvcpus": "{{user `numvcpus`}}"
      },
      "output_directory": "output-base",
      "floppy_files": [
        "scripts/bios/gui/autounattend.xml"
      ],
      "shutdown_command": "shutdown /s /t 5 /f /d p:4:1 /c \"Packer Shutdown\"",
      "shutdown_timeout": "30m"
    },
    {
      "type":             "vmware-vmx",
      "communicator":     "none",
      "source_path":      "output-base/{{user `vm_name`}}.vmx",
      "linked":           true,
      "vm_name":          "{{user `vm_name`}}-linked",
      "output_directory": "output-linked"
    }
  ],
  "provisioners": [
    {
      "type":    "powershell",
      "scripts": ["scripts/setup.ps1"]
    },
    {
      "type":         "powershell",
      "scripts":      ["scripts/cleanup.ps1"],
      "pause_before": "1m"
    }
  ]
}
