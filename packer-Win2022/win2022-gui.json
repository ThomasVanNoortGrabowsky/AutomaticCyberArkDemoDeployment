{
  "variables": {
    "iso_url":         "https://software-download.microsoft.com/download/sg/20348.169.210806-2348.fe_release_svc_refresh_SERVER_EVAL_x64FRE_en-us.iso",
    "iso_checksum":    "sha256:4f1457c4fe14ce48c9b2324924f33ca4f0470475e6da851b39ccbf98f44e7852",
    "vm_name":         "Win2022-GUI-Minimal",
    "vm_memory":       "2048",
    "vm_cpus":         "2",
    "winrm_user":      "Administrator",
    "winrm_pass":      "packer",
    "boot_wait":       "5s",
    "disk_size":       "40960"
  },
  "builders": [{
    "type":           "vmware-iso",
    "guest_os_type":  "windows2022srv-64",
    "vm_name":        "{{user `vm_name`}}",
    "iso_url":        "{{user `iso_url`}}",
    "iso_checksum":   "{{user `iso_checksum`}}",
    "boot_wait":      "{{user `boot_wait`}}",
    "disk_size":      "{{user `disk_size`}}",
    "headless":       false,
    "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
    "shutdown_timeout": "20m",
    "communicator":   "winrm",
    "winrm_username": "{{user `winrm_user`}}",
    "winrm_password": "{{user `winrm_pass`}}",
    "winrm_port":     5985,
    "floppy_files":   ["autounattend.xml"],
    "vmx_data": {
      "memsize":           "{{user `vm_memory`}}",
      "numvcpus":          "{{user `vm_cpus`}}",
      "virtualHW.version": "18"
    }
  }],
  "provisioners": [
    {
      "type":             "powershell",
      "inline": [
        "Write-Host 'Running post-install cleanup...'",
        # Remove temp files, clear logs
        "Remove-Item 'C:\\Windows\\Temp\\*' -Recurse -Force",
        "wevtutil cl Application",
        "wevtutil cl System"
      ],
      "valid_exit_codes": [0, 1, 3010]
    }
  ]
}
